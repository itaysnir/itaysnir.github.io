---
layout: post
title:  "Linux Kernel Development Tips"
date:   2022-09-06 19:59:43 +0300
categories: jekyll update
---

1. Clone your desired kernel tree

2. Create a .config file
Personally, i highly discourage using "make menuconfig". This method includes way too many useless drivers, significally increasing compilation time. 

Instead, i sugget using:
{% highlight bash %}
make localmodconfig
{% endhighlight %}
Which configurates only the loaded modules, as stated by lsmod. 

Another good alternative, is using :
{% highlight bash %}
make allnoconfig
{% endhighlight %}
And manually enable few of the desired modules, as stated [in this great post][great-post].

Also - to avoid any pem certificate warning crap, disable the following config attribute:
{% highlight bash %}
<KDIR>/scripts/config --set-str SYSTEM_TRUSTED_KEYS ""
{% endhighlight %}

[great-post]: https://blog.nelhage.com/2013/12/lightweight-linux-kernel-development-with-kvm/

3. Compile:
Make sure the compilation machine contains at least 4 cores:
{% highlight bash %}
ncores
{% endhighlight %}

To reduce compilation time, compile the kernel only for your desired arch (assuming x86), with (ncores + 1) threads:
{% highlight bash %}
# within <KDIR>
make ARCH=x86 -j 5
sudo make -j 5 modules_install
{% endhighlight %}

Note - another compilation of the selected kernel modules is needed. 

Hooray! our lovely kernel now resides at the boot directory: 
{% highlight bash %}
<KDIR>/arch/x86/boot/bzImage
{% endhighlight %}
