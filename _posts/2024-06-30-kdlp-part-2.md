---
layout: post
title:  "KDLP - Part 2"
date:   2024-07-01 19:59:45 +0300
categories: jekyll update
---

**Contents**
* TOC
{:toc}
## Lecture 13

Covers character devices - motivation, interaction, implementation.

### Chardevs

Character-by-character kernel interface. Meaning a byte-stream, not buffered, input. For example, keyboard, mouse. But it isn't necessarily related to physical device. \
Character devices can be found under `/dev`, having `c` as file type. Uniquely identified by major (type / category identifier), minor (instance identifier) numbers. Generally, implemented as a kernel module. We can create character (unbuffered) / block (buffered) manually devices via `mknod`. \
Another interesting file is `/proc/devices`, which contains the major to device type mapping. 

### Interaction

Everything is a file. Hence, simple `cat, echo` commands works on the device files. Also syscalls involving fds. 

### Examples

Some useful devices:

```bash
/dev/null  # discard input
/dev/zero  # infinite number of b'\x00' output
/dev/tty   # this terminal, equivalent of R/W from stdin/stdout
/dev/kmsg  # kernel ring buffer access, dmesg parses this
/dev/urandom  # infinite random bytes, crypto-secured
/dev/random  # same, but can block in case system's entropy is low (for example, shortly after boot)
/dev/mem  # Physical memory access!
```

### PRNG Chardev Impl

Demonstration of a basic character device kernel module. We have to perform few steps:

1. Assign major, minor numbers

2. Set file operations - `fops`, that stores addresses of the handlers. 

3. Register device with cdev subsystem

4. Implement handlers for `open, close`

5. Implement handlers for `read, write`

37:12

